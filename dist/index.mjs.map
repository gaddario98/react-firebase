{"version":3,"file":"index.mjs","sources":["../../lib/useFirebaseAuth.common.ts","../../lib/useFirebaseAuth.ts","../../lib/useFirebaseAuthProvider.common.ts","../../lib/config.ts","../../lib/useFirebaseAuthProvider.ts","../../lib/token.ts","../../lib/logout.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useNotification } from \"@gaddario98/react-notifications\";\n\nexport interface AuthResponse<T> {\n  success: boolean;\n  error?: string;\n  user?: T;\n}\n\nexport interface LoginProps {\n  email: string;\n  password: string;\n}\n\nexport type UseFirebaseAuth<T> = {\n  loading: boolean;\n  error: string | null;\n  loginWithEmail: (props: LoginProps) => Promise<AuthResponse<T>>;\n  registerWithEmail: (\n    email: string,\n    password: string,\n    name: string\n  ) => Promise<AuthResponse<T>>;\n  logout: () => Promise<void>;\n  loginWithGoogle: () => Promise<AuthResponse<T>>;\n  loginWithApple: () => Promise<AuthResponse<T>>;\n};\n\nexport const ERROR_KEYS = {\n  EMAIL_ALREADY_IN_USE: \"errors.emailAlreadyInUse\",\n  INVALID_EMAIL: \"errors.invalidEmail\",\n  OPERATION_NOT_ALLOWED: \"errors.operationNotAllowed\",\n  WEAK_PASSWORD: \"errors.weakPassword\",\n  USER_DISABLED: \"errors.userDisabled\",\n  USER_NOT_FOUND: \"errors.userNotFound\",\n  WRONG_PASSWORD: \"errors.wrongPassword\",\n  UNEXPECTED_ERROR: \"errors.unexpectedError\",\n  SIGN_OUT_ERROR: \"errors.signOutError\",\n  GOOGLE_SIGN_IN_FAILED: \"errors.googleSignInFailed\",\n  APPLE_SIGN_IN_FAILED: \"errors.appleSignInFailed\",\n  PLAY_SERVICES_NOT_AVAILABLE: \"errors.playServicesNotAvailable\",\n} as const;\n\nexport const useFirebaseAuthCommon = () => {\n  const { t } = useTranslation(\"auth\");\n  const { showNotification } = useNotification();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const handleAuthError = useCallback(\n    (error: unknown): string => {\n      if (error instanceof Error) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const errorCode = (error as any).code;\n        if (errorCode) {\n          switch (errorCode) {\n            case \"auth/email-already-in-use\":\n              return t(\"errors.emailAlreadyInUse\");\n            case \"auth/invalid-email\":\n              return t(\"errors.invalidEmail\");\n            case \"auth/operation-not-allowed\":\n              return t(\"errors.operationNotAllowed\");\n            case \"auth/weak-password\":\n              return t(\"errors.weakPassword\");\n            case \"auth/user-disabled\":\n              return t(\"errors.userDisabled\");\n            case \"auth/user-not-found\":\n              return t(\"errors.userNotFound\");\n            case \"auth/wrong-password\":\n              return t(\"errors.wrongPassword\");\n            default:\n              return t(\"errors.unexpectedError\");\n          }\n        }\n        return t(\"errors.unexpectedError\");\n      }\n      return t(\"errors.unexpectedError\");\n    },\n    [t]\n  );\n\n  useEffect(() => {\n    if (error) showNotification({ message: error, type: \"error\" });\n  }, [error, showNotification]);\n\n  return {\n    loading,\n    setLoading,\n    error,\n    setError,\n    handleAuthError,\n  };\n};\n","import { useCallback } from \"react\";\nimport {\n  useFirebaseAuthCommon,\n  UseFirebaseAuth,\n  AuthResponse,\n  LoginProps,\n} from \"./useFirebaseAuth.common\";\nimport {\n  createUserWithEmailAndPassword,\n  getAuth,\n  GoogleAuthProvider,\n  OAuthProvider,\n  sendEmailVerification,\n  signInWithEmailAndPassword,\n  signInWithPopup,\n  signOut,\n  updateProfile,\n  User,\n  UserCredential,\n} from \"firebase/auth\";\nimport { useTranslation } from \"react-i18next\";\n\nexport const useFirebaseAuth = (): UseFirebaseAuth<User> => {\n  const { loading, setLoading, error, setError, handleAuthError } =\n    useFirebaseAuthCommon();\n  const { i18n } = useTranslation();\n\n  const withErrorHandling = useCallback(\n    async <T extends AuthResponse<User>>(\n      operation: () => Promise<UserCredential>\n    ): Promise<T> => {\n      setError(null);\n      setLoading(true);\n      try {\n        const result = await operation();\n        return { success: true, user: result?.user } as T;\n      } catch (error) {\n        const errorMessage = handleAuthError(error);\n        setError(errorMessage);\n        return { success: false, error: errorMessage } as T;\n      } finally {\n        setLoading(false);\n      }\n    },\n    [handleAuthError, setError, setLoading]\n  );\n\n  const loginWithEmail = useCallback(\n    async ({ email, password }: LoginProps) =>\n      withErrorHandling(() =>\n        signInWithEmailAndPassword(getAuth(), email, password)\n      ),\n    [withErrorHandling]\n  );\n\n  const registerWithEmail = async (\n    email: string,\n    password: string,\n    name: string\n  ) =>\n    withErrorHandling(async () => {\n      const credential = await createUserWithEmailAndPassword(\n        getAuth(),\n        email,\n        password\n      );\n      await updateProfile(credential.user, { displayName: name });\n      await sendEmailVerification(credential.user);\n      return credential;\n    });\n\n  const logout = useCallback(async () => {\n    setLoading(true);\n    try {\n      await signOut(getAuth());\n    } finally {\n      setLoading(false);\n    }\n  }, [setLoading]);\n\n  const loginWithGoogle = useCallback(async () => {\n    return withErrorHandling(async () => {\n      const authInstance = getAuth();\n      const provider = new GoogleAuthProvider();\n      authInstance.languageCode = i18n.language;\n      return await signInWithPopup(authInstance, provider);\n    });\n  }, [withErrorHandling]);\n\n  const loginWithApple = useCallback(async () => {\n    return withErrorHandling(async () => {\n      const authInstance = getAuth();\n      const provider = new OAuthProvider(\"apple.com\");\n      provider.addScope(\"email\");\n      provider.addScope(\"name\");\n      provider.setCustomParameters({\n        locale: i18n.language,\n      });\n      return await signInWithPopup(authInstance, provider);\n    });\n  }, [withErrorHandling]);\n\n  return {\n    loading,\n    error,\n    loginWithEmail,\n    registerWithEmail,\n    logout,\n    loginWithGoogle,\n    loginWithApple,\n  };\n};\n","import { useRef, useState } from \"react\";\nimport { AuthState } from \"@gaddario98/react-auth\";\n\nexport const useFirebaseAuthProviderCommon = () => {\n  const [loading, setLoading] = useState(true);\n  const authRef = useRef<AuthState | undefined>(undefined);\n\n  return {\n    loading,\n    setLoading,\n    authRef\n  };\n};\n","import { deleteApp, getApp, getApps, initializeApp } from \"firebase/app\";\nimport { Analytics, getAnalytics, isSupported } from \"firebase/analytics\";\n\nlet firebaseConfig = {\n  apiKey: \"\",\n  authDomain: \"\",\n  databaseURL: \"\",\n  projectId: \"\",\n  storageBucket: \"\",\n  messagingSenderId: \"\",\n  appId: \"\",\n  measurementId: \"\",\n};\n\nlet analyticsInstance: Analytics;\n\nconst inizialize = () => {\n  if (firebaseConfig?.apiKey) {\n    const app = initializeApp(firebaseConfig);\n    isSupported().then((supported) => {\n      if (supported) analyticsInstance = getAnalytics(app);\n    });\n    return app;\n  }\n};\n\nconst setFirebaseConfig = async (config: typeof firebaseConfig) => {\n  firebaseConfig = config;\n\n  if (getApps().length) {\n    await deleteApp(getApp());\n  }\n  return inizialize();\n};\n\nexport { firebaseConfig, setFirebaseConfig, analyticsInstance };\n","import { useCallback, useEffect, useRef, useState } from \"react\";\nimport { useFirebaseAuthProviderCommon } from \"./useFirebaseAuthProvider.common\";\nimport { getAuth, getIdTokenResult, onIdTokenChanged } from \"firebase/auth\";\nimport { setUserId } from \"firebase/analytics\";\nimport { analyticsInstance } from \"./config\";\nimport { AuthState } from \"@gaddario98/react-auth\";\n\n// Calculate next refresh delay from token result with safety bounds\nconst nextRefreshDelayMs = (expirationTimeISO: string): number => {\n  const now = Date.now();\n  const expirationTime = Date.parse(expirationTimeISO);\n  const timeUntilExp = Math.max(0, expirationTime - now);\n  // refresh 30s before expiry; clamp between 30s and 55m\n  const SAFETY = 30 * 1000;\n  const MIN = 30 * 1000;\n  const MAX = 55 * 60 * 1000;\n  const desired = Math.max(MIN, timeUntilExp - SAFETY);\n  return Math.min(MAX, desired);\n};\n\nexport interface FirebaseProviderProps {\n  initializeNotifications: (id: string) => Promise<void>;\n  setFirebaseAuth: (auth?: AuthState) => void;\n}\nexport const useFirebaseAuthProvider = ({\n  initializeNotifications,\n  setFirebaseAuth,\n}: FirebaseProviderProps) => {\n  const { loading, setLoading, authRef } = useFirebaseAuthProviderCommon();\n  const [, setAuthState] = useState<AuthState | undefined>(undefined);\n  const refreshTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  // Helper to clear any scheduled fallback refresh (memoized)\n  const clearRefreshTimeout = useCallback(() => {\n    if (refreshTimeoutRef.current) {\n      clearTimeout(refreshTimeoutRef.current);\n      refreshTimeoutRef.current = null;\n    }\n  }, []);\n\n  // Schedule a safe fallback refresh slightly before token expiration. (memoized)\n  const scheduleFallbackRefresh = useCallback(async () => {\n    try {\n      const auth = getAuth();\n      const user = auth.currentUser;\n      if (!user) {\n        clearRefreshTimeout();\n        return;\n      }\n      const tokenResult = await getIdTokenResult(user, false);\n      const delay = nextRefreshDelayMs(tokenResult.expirationTime);\n      clearRefreshTimeout();\n      refreshTimeoutRef.current = setTimeout(async () => {\n        try {\n          // Force a refresh; onIdTokenChanged will fire and reschedule.\n          await user.getIdToken(true);\n        } catch (err) {\n          console.error(\"Fallback token refresh error:\", err);\n        }\n      }, delay);\n    } catch (err) {\n      console.error(\"Error scheduling fallback token refresh:\", err);\n    }\n  }, [clearRefreshTimeout]);\n\n  // Update and propagate AuthState (memoized)\n  const updateAuthState = useCallback(\n    async (\n      uidChanged: boolean,\n      user: NonNullable<ReturnType<typeof getAuth>[\"currentUser\"]>\n    ) => {\n      const tokenResult = await getIdTokenResult(user, false);\n      const newAuthState: AuthState = {\n        accountVerified: user.emailVerified || !!user.phoneNumber,\n        id: user.uid,\n        isLogged: true,\n        token: tokenResult.token,\n        phoneNumber: user.phoneNumber ?? \"\",\n        email: user.email ?? \"\",\n      };\n\n      setFirebaseAuth?.(newAuthState);\n      setAuthState(newAuthState);\n      authRef.current = newAuthState;\n\n      try {\n        await initializeNotifications(newAuthState.id);\n      } catch (e) {\n        console.error(\"initializeNotifications error:\", e);\n      }\n      if (uidChanged) {\n        if (analyticsInstance) {\n          setUserId(analyticsInstance, newAuthState.id);\n        }\n      }\n\n      await scheduleFallbackRefresh();\n    },\n    [initializeNotifications, setFirebaseAuth, authRef, scheduleFallbackRefresh]\n  );\n\n  useEffect(() => {\n    const auth = getAuth();\n    let initialized = false;\n\n    const unsubscribe = onIdTokenChanged(auth, async (user) => {\n      try {\n        if (user) {\n          const prev = authRef.current;\n          const uidChanged = prev?.id !== user.uid;\n          await updateAuthState(uidChanged, user);\n        } else {\n          // Logged out\n          clearRefreshTimeout();\n          setAuthState(undefined);\n          authRef.current = undefined;\n          setFirebaseAuth?.(undefined);\n        }\n      } catch (error) {\n        console.error(\"onIdTokenChanged handler error:\", error);\n      } finally {\n        if (!initialized) {\n          initialized = true;\n          // Small delay to keep UX parity with previous behavior\n          setTimeout(() => setLoading(false), 300);\n        }\n      }\n    });\n\n    return () => {\n      unsubscribe();\n      clearRefreshTimeout();\n    };\n  }, [\n    setLoading,\n    updateAuthState,\n    scheduleFallbackRefresh,\n    clearRefreshTimeout,\n  ]);\n\n  return { loading };\n};\n","import { getAuth, getIdToken } from \"firebase/auth\";\n\nexport const getToken = async() => {\n  const user = getAuth();\n\n  if (user?.currentUser) {\n    const token = await getIdToken(user.currentUser);\n    return  `Bearer ${token}`;\n  }\n  return '';\n};\n","import { getAuth, signOut } from \"firebase/auth\";\n\nexport const logout = async () => {\n  await signOut(getAuth());\n};\n"],"names":[],"mappings":"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"}